<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lexio 60</title>
<style>
body {background:#0b1020;color:white;font-family:sans-serif;margin:0;padding:0;}
header, footer {padding:10px 20px;background:#111735;}
header h1 {margin:0;font-size:20px;}
main {padding:20px;max-width:1200px;margin:auto;display:flex;flex-direction:column;gap:20px;}
.tile {display:inline-block;padding:10px 14px;margin:4px;border-radius:12px;background:#0e163f;border:1px solid #2a3980;cursor:pointer;user-select:none;}
.tile.selected {outline:3px solid #86a5ff;}
.row {display:flex;gap:10px;flex-wrap:wrap;}
.card {background:#111735;padding:14px;border-radius:16px;}
.button {padding:8px 14px;border:none;border-radius:12px;background:#3858ff;color:white;cursor:pointer;}
.button.ghost {background:#0f173f;}
.button.danger {background:#6a1a49;}
.log {height:200px;overflow:auto;background:#0e1436;border-radius:12px;padding:8px;}
</style>
</head>
<body>
<header>
<h1>Lexio 60</h1>
</header>
<main>
<div class="card">
<label>플레이어 수:
<select id="playerCount">
<option value="2">2</option>
<option value="3" selected>3</option>
<option value="4">4</option>
</select>
</label>
<label>AI 난이도:
<select id="aiLevel">
<option value="easy">초보</option>
<option value="medium" selected>중수</option>
<option value="hard">고수</option>
</select>
</label>
<button class="button" id="startBtn">게임 시작</button>
</div>

<div class="card">
<h3>테이블</h3>
<div id="tableTiles" class="row"></div>
<p id="tableLead">현재 장수/조합: -</p>
</div>

<div class="card">
<h3>플레이어 손패</h3>
<div id="playerHand" class="row"></div>
<button class="button" id="playBtn">선택 카드 내기</button>
<button class="button ghost" id="passBtn">패스</button>
</div>

<div class="card">
<h3>로그</h3>
<div id="log" class="log"></div>
</div>
</main>
<footer>
Lexio 60 © 2025
</footer>

<script>
const SUITS=["해","달","별","구름"];
const SUIT_SYMBOL={해:"☀️",달:"🌙",별:"⭐",구름:"☁️"};
const SUIT_VALUE={구름:1,별:2,달:3,해:4};

let players=[],turn=0,table=null,winner=null,selectedTiles={};
let aiLevel="medium";

function log(msg){const b=document.getElementById("log");const p=document.createElement("p");p.textContent=msg;b.appendChild(p);b.scrollTop=b.scrollHeight;}

function createDeck(){
  const deck=[];
  for(const s of SUITS) for(let n=2;n<=16;n++) deck.push({suit:s,num:n});
  return deck.slice(0,60);
}

function shuffle(deck){let d=[...deck];for(let i=d.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[d[i],d[j]]=[d[j],d[i]]}return d;}

function deal(playerCount){
  let deck=shuffle(createDeck());
  let per=Math.floor(60/playerCount);
  players=[];
  for(let i=0;i<playerCount;i++){
    players.push({
      id:i,
      name:i===0?"YOU":`AI ${i}`,
      isHuman:i===0,
      hand:deck.slice(i*per,(i+1)*per),
      passed:false,
      isOut:false,
      lastPlay:null
    });
  }
}

function pickStarter(){
  const p=players.find(p=>p.hand.some(c=>c.num===2&&c.suit==="해"));
  return p?p.id:0;
}

function sortHand(hand){return hand.slice().sort((a,b)=>b.num-a.num||SUIT_VALUE[b.suit]-SUIT_VALUE[a.suit]);}

function renderHand(){
  const handDiv=document.getElementById("playerHand");
  handDiv.innerHTML="";
  const me=players[0];
  for(const t of me.hand){
    const div=document.createElement("div");
    div.className="tile";
    if(selectedTiles[`${t.suit}-${t.num}`]) div.classList.add("selected");
    div.textContent=`${SUIT_SYMBOL[t.suit]}${t.num}`;
    div.onclick=()=>{const k=`${t.suit}-${t.num}`;selectedTiles[k]=!selectedTiles[k];renderHand();};
    handDiv.appendChild(div);
  }
}

function renderTable(){
  const tableDiv=document.getElementById("tableTiles");
  tableDiv.innerHTML="";
  if(table?.currentTop) for(const t of table.currentTop.tiles){
    const div=document.createElement("div");
    div.className="tile";
    div.textContent=`${SUIT_SYMBOL[t.suit]}${t.num}`;
    tableDiv.appendChild(div);
  }
  document.getElementById("tableLead").textContent=table?.currentTop?`장수:${table.currentTop.tiles.length}, 조합:${table.currentTop.type}`:"-";
}

function renderAll(){
  renderHand();
  renderTable();
}

function identifyMeld(tiles){
  if(tiles.length===1) return {type:"SINGLE",tiles,key:[tiles[0].num,SUIT_VALUE[tiles[0].suit]]};
  if(tiles.length===2&&tiles[0].num===tiles[1].num) return {type:"PAIR",tiles,key:[tiles[0].num,Math.max(SUIT_VALUE[tiles[0].suit],SUIT_VALUE[tiles[1].suit])]};
  if(tiles.length===3&&tiles.every(c=>c.num===tiles[0].num)) return {type:"TRIPLE",tiles,key:[tiles[0].num,Math.max(...tiles.map(c=>SUIT_VALUE[c.suit]))]};
  return null;
}

function compareMeld(a,b){
  if(a.tiles.length!==b.tiles.length) return null;
  for(let i=0;i<a.key.length;i++){
    if(a.key[i]!==b.key[i]) return a.key[i]-b.key[i];
  }
  return 0;
}

function nextTurn(){
  const alive=players.filter(p=>!p.isOut).map(p=>p.id);
  do{turn=(turn+1)%players.length;}while(!alive.includes(turn));
  renderAll();
  if(!players[turn].isHuman) setTimeout(()=>aiPlay(players[turn]),500);
}

function aiPlay(player){
  const cand=player.hand[0]?identifyMeld([player.hand[0]]):null;
  if(cand){playTiles(player,cand.tiles,cand.type);}else{passTurn();}
}

function playTiles(player,tiles,type){
  player.hand=player.hand.filter(c=>!tiles.includes(c));
  const meld={type,tiles};
  table.currentTop=meld;
  player.lastPlay=meld;
  player.passed=false;
  log(`${player.name} ▶ ${type} : ${tiles.map(c=>`${SUIT_SYMBOL[c.suit]}${c.num}`).join(",")}`);
  if(player.hand.length===0){player.isOut=true;endGame(player);}
  else nextTurn();
}

function humanPlay(){
  const me=players[0];
  const tiles=me.hand.filter(c=>selectedTiles[`${c.suit}-${c.num}`]);
  if(tiles.length===0){log("카드를 선택해주세요."); return;}
  const meld=identifyMeld(tiles);
  if(!meld){log("유효한 조합이 아닙니다."); return;}
  playTiles(me,tiles,meld.type);
  selectedTiles={};
}

function passTurn(){
  const p=players[turn];
  p.passed=true;
  log(`${p.name} ▶ PASS`);
  nextTurn();
}

function startGame(){
  const pc=+document.getElementById("playerCount").value;
  aiLevel=document.getElementById("aiLevel").value;
  deal(pc);
  turn=pickStarter();
  table={currentTop:null,leaderId:turn};
  winner=null;
  log("게임 시작");
  renderAll();
  if(!players[turn].isHuman) setTimeout(()=>aiPlay(players[turn]),500);
}

function endGame(player){
  winner=player;
  log(`게임 종료! 승자: ${player.name}`);
  alert(`게임 종료! 승자: ${player.name}`);
}

document.getElementById("startBtn").onclick=startGame;
document.getElementById("playBtn").onclick=humanPlay;
document.getElementById("passBtn").onclick=passTurn;
</script>
</body>
</html>
